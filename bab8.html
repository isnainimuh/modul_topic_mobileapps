<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Target Week 8 - Cart Screen & Checkout Flow</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css">
</head>
<body>
  <header>
    <h1>Target Week 8 - Cart Screen & Checkout Flow</h1>
    <nav>
      <a href="index.html">üè† Daftar Materi</a> |
      <a href="bab7.html">‚¨ÖÔ∏è Target Sebelumnya</a> |
      <a href="bab9.html">‚û°Ô∏è Target Berikutnya</a>
    </nav>
  </header>

  <main>
    <h2>Cart Screen</h2>
    <p>Tahap berikutnya kita buat screen untuk keranjang belanja.
      Sebelum itu, kita edit dulu cart provider dengan menambahkan 
      integrasi ke backend via API.
    </p>
    <h3>Step 1. Perbaiki Cart Provider</h3>
    <p>Copy dan replace dengan kode berikut. <br>
      Lokasi file: lib/screens/cart_provider.dart</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="cart-provider" class="language-php"></code></pre>
    </div>

    <h3>Step 2. Perbaiki ApiService untuk Cart</h3>
    <p>Ganti kode pada fungsi-fungsi Cart di ApiService meliputi fungsi 
      getCart, addToCart, updateCartItem dan removeFromCart dengan kode berikut. 
      Lalu tambahkan fungsi clearCart di ApiService.
    </p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="api-service" class="language-php"></code></pre>
    </div>

    <h3>Step 3. Buat Cart Screen UI</h3>
    <p>Lokasi file: lib/screens/cart_screen.dart</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="cart-screen" class="language-php"></code></pre>
    </div>

    <h3>Step 4. Perbaiki AuthProvider</h3>
    <p>Auth Provider belum memanggil userId, sehingga perlu kita tambahkan. <br>
    Copy dan replace kode pada Auth Provider dengan kode berikut.</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="auth-provider" class="language-php"></code></pre>
    </div>

    <h2>Checkout Screen</h2>
    <p>Lagkah berikutnya membuat screen untuk proses check out. <br>
      Lokasi file: lib/screens/checkout_screen.dart</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="co-screen" class="language-php"></code></pre>
    </div>

    <h2>Perbaiki Api Service</h2>
    <p>Terdapat error message pada kode checkout_screen.dart karena 
      beberapa fungsi belum didefinisikan dengan benar pada api service.<br>
      Pertama, ganti method createOrder pada api service dengan kode berikut:
    </p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="api-create-order" class="language-php"></code></pre>
    </div>
    <p>Kedua, ganti method getUserOrders pada api service dengan kode berikut:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="api-getuser-order" class="language-php"></code></pre>
    </div>
    <p>Ketiga, ganti method getOrderDetails pada api service dengan kode berikut:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="api-getorder-detail" class="language-php"></code></pre>
    </div>
    <p>Keempat, perbaiki juga pemanggilan Add to Cart di product detail screen.<br>
    Lokasi file: lib/screens/product_detail_screen.dart</p>
    <p>Cari kode berikut:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
cartProvider.addToCart(
  authProvider.token!,
  product.productId,
  1,
);
      </code></pre>
    </div>

    <p>Ganti menjadi kode berikut:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
cartProvider.addToCart(
  authProvider.token!,
  authProvider.userId!,     // ‚ûú tambahkan ini
  product.productId,
  1,
);
      </code></pre>
    </div>
  
    <h3>Update Checkout Screen</h3>
    <p>Cari kode ini pada checkout screen:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
final cartProvider = Provider.of<CartProvider>(context);
final authProvider = Provider.of<AuthProvider>(context);
      </code></pre>
    </div>
    <p>Ganti menjadi kode berikut:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
final cartProvider = Provider.of<CartProvider>(context);
final authProvider = Provider.of<AuthProvider>(context);
final orderProvider = Provider.of<OrderProvider>(context, listen: false);
      </code></pre>
    </div>

    <p>Ubah juga bagian Submit Order. Cari kode ini di checkout screen:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
await cartProvider.createOrder(
  token,
  userId,
  {
    "name": ...,
    "payment_method": _paymentMethod,
  },
);
      </code></pre>
    </div>
    <p>Ganti menjadi kode berikut:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
await orderProvider.createOrder(
  authProvider.token!,
  {
    "name": _nameController.text.trim(),
    "phone": _phoneController.text.trim(),
    "address": _addressController.text.trim(),
    "city": _cityController.text.trim(),
    "postal_code": _postalController.text.trim(),
    "payment_method": _paymentMethod,
  },
);
      </code></pre>
    </div>

    <p>Ini adalah versi final Checout Screen pada bagian SUbmit Order.</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="co-submit" class="language-php"></code></pre>
    </div>

    <p>Kemudian pada bagian button submit order di checkout screen, cari kode ini:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
await _submitOrder(
  authProvider,
  cartProvider,
);
      </code></pre>
    </div>
    <p>Ganti dengan kode berikut (menambahkan 1 parameter):</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
await _submitOrder(
  authProvider,
  cartProvider,
  orderProvider,
);
      </code></pre>
    </div>
    <p>Sekarang seharusnya semua file kode aman dan tidak ada error.</p>

    <h2>Navigation Cart Screen</h2>
    <p>Kita tambahkan button untuk navigasi ke cart screen.
      Tambahkan icon keranjang pada AppBar di Homescreen.<br>
      Lokasi file: lib/screens/home_screen.dart
    </p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code id="appbar" class="language-php"></code></pre>
    </div>

    <h2>Daftarkan Route ke CartScreen & CheckoutScreen</h2>
    <p>Pada file main.dart tambahkan routes:</p>
    <div class="code-block">
      <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      <pre><code class="language-php">
routes: {
  '/cart': (context) => const CartScreen(),
  '/checkout': (context) => const CheckoutScreen(),
},
      </code></pre>
    </div>

    <h2>Pengujian</h2>
    <p>Jalan aplikasi (backend dan frontend) kemudian lakukan aktivitas
      tambahkan produk ke keranjang, klik icon keranjang di AppBar, jika 
      tampilan produk di keranjang sudah sesuai berarti sudah sukses. Klik 'checkout',
      jika tampilan checkout sudah sesuai maka berhasil.
    </p>
    <figure>
      <img src="images/8addtocart.png" alt="8addtocart" class="code-image">
      <figcaption>Gambar 8.1 Jumlah produk yang ditambahkan di keranjang terlihat</figcaption>
    </figure>
    <figure>
      <img src="images/8cart.png" alt="8cart" class="code-image">
      <figcaption>Gambar 8.2 Tampilan produk yang ditambahkan ke keranjang</figcaption>
    </figure>
    <figure>
      <img src="images/8checkout.png" alt="8checkout" class="code-image">
      <figcaption>Gambar 8.3 Tampilan checkout</figcaption>
    </figure>
  </main>

  
  <footer>
    <a href="index.html">‚Üê Kembali</a>
  </footer>

  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script>
function loadCode(fileName, elementId) {
  fetch(fileName)
    .then(res => res.text())
    .then(code => {
      const el = document.getElementById(elementId);
      el.textContent = code;
      Prism.highlightElement(el);
    })
    .catch(err => console.error('Gagal memuat file:', err));
}

// memuat file langsung dari folder /codes/
loadCode('codes/8cart-provider.txt', 'cart-provider');
loadCode('codes/8api-service.txt', 'api-service');
loadCode('codes/8cart-screen.txt', 'cart-screen');
loadCode('codes/8auth-provider.txt', 'auth-provider');
loadCode('codes/8co-screen.txt', 'co-screen');
loadCode('codes/8api-create-order.txt', 'api-create-order');
loadCode('codes/8api-getuser-order.txt', 'api-getuser-order');
loadCode('codes/8api-getorder-detail.txt', 'api-getorder-detail');
loadCode('codes/8co-submit.txt', 'co-submit');
loadCode('codes/8appbar.txt', 'appbar');
</script>

</body>
</html>
